<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>
    小布CVG
  </title>
  
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

  
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

  
<link rel="stylesheet" href="/css/style.css">


  <!-- 百度统计 -->
  <script>
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?70e6a2d8bff4ee09161860a6fcead42a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
<meta name="generator" content="Hexo 5.2.0"></head>

<body id="bodyx" class="bg_while">
  <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            centos7静默安装oracle数据库
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>静默安装就是不使用图形化界面的安装，全部用命令与配置文件进行安装的方式。<br>如果你在 Windows 下安装过 Oracle 数据库，理解起来可能会比较简单。<br>个人使用的环境为：Centos7 + Oracle11gR2。<br>提前去官网下载好 Oracle 的压缩包，放到 <code>/opt/download</code> 目录中，可能有两个压缩包，使用命令 <code>unzip xxx1.zip</code> 、<code>unzip xxx2.zip</code> 将两个压缩包解压，得到 <code>database</code> 目录。</p>
<h2 id="二、步骤拆解"><a href="#二、步骤拆解" class="headerlink" title="二、步骤拆解"></a>二、步骤拆解</h2><p>系统环境配置  |  安装数据库软件  |  配置静默监听  |  静默方式创建数据库同时建立实例</p>
<h2 id="三、详细步骤"><a href="#三、详细步骤" class="headerlink" title="三、详细步骤"></a>三、详细步骤</h2><h4 id="3-1-系统环境配置"><a href="#3-1-系统环境配置" class="headerlink" title="3.1 系统环境配置"></a>3.1 系统环境配置</h4><p><strong>3.1.1 安装依赖</strong><br>这些是需要的依赖，需要先安装好，不能漏掉。</p>
<pre><code class="shell"># yum install 
  gcc 
  make 
  binutils 
  gcc-c++ 
  compat-libstdc++-33elfutils-libelf-devel 
  elfutils-libelf-devel-static 
  ksh 
  libaio 
  libaio-develnumactl-devel 
  sysstat 
  unixODBC 
  unixODBC-devel 
  pcre-devel </code></pre>
<p><strong>3.1.2 配置用户和组</strong><br>安装 Oracle 需要用到 oracle 用户，所以需要手动创建好用户和用户组。</p>
<pre><code class="shell">[root@CentOS \]# groupadd oinstall      # 这是创建用户组
[root@CentOS \]# groupadd dba           # 这是创建用户组
[root@CentOS \]# useradd -g oinstall -G dba oracle   # 这是创建用户并指定用户组
[root@CentOS \]# passwd oracle       # 这是配置用户密码</code></pre>
<p>创建好之后可以确认一下用户信息。</p>
<pre><code class="shell">[root@CentOS \] id oracle    # 这是查看用户信息</code></pre>
<p>这是输出信息。</p>
<pre><code class="shell">uid=1001(oracle) gid=1001(oinstall) 组=1001(oinstall),1002(dba)</code></pre>
<p><strong>3.1.3 修改内核参数配置文件</strong><br>这一步是让 Oracle 更好的工作。<br>使用命令 <code>vim /etc/sysctl.conf</code> 打开配置文件，文件后面追加下面的内容。</p>
<pre><code class="shell">fs.aio-max-nr = 1048576
fs.file-max = 6815744
kernel.shmall = 2097152
kernel.shmmax = 1073741824         # 本机物理内存（2G）的一半
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 9000 65500
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576</code></pre>
<p><em>注：其中 <code>kernel.shmmax = 1073741824</code> 设置为本机物理内存（2G）的一半，单位为byte。</em><br>保存退出后使用命令 <code> sysctl -p</code> 使其生效。</p>
<p><strong>3.1.4 修改用户限制文件</strong><br>这一步是限制 Oracl 用户的权限。<br>使用命令 <code>vim /etc/security/limits.conf</code> 打开用户限制配置文件。<br>在文件的后面追加以下内容：</p>
<pre><code>oracle           soft      nproc           2047
oracle           hard     nproc         16384
oracle           soft      nofile           1024
oracle           hard     nofile          65536
oracle           soft      stack           10240</code></pre>
<p>保存退出。<br>使用命令 <code>vim /etc/pam.d/login</code> 打开用户登录配置文件。<br>在文件后面追加以下内容：</p>
<pre><code>session required   /lib64/security/pam_limits.so
session required   pam_limits.so</code></pre>
<p>保存退出。<br>使用命令 <code>vim /etc/profile</code> 打开环境变量配置文件。<br>在文件后面追加以下内容：</p>
<pre><code>if [ $USER = &quot;oracle&quot; ]; then
  if[ $SHELL = &quot;/bin/ksh&quot; ]; then
    ulimit -p 16384
    ulimit -n 65536
  else
    ulimit -u 16384 -n 65536
  fi
fi</code></pre>
<p>保存退出。</p>
<p><strong>3.1.5 创建安装目录、设置文件权限</strong><br>执行以下命令。</p>
<pre><code class="shell">[root@CentOS /]# mkdir -p /data/oracle/product/11.2.0      # 这是创建安装目录
[root@CentOS /]# mkdir /data/oracle/oradata                     # 这是创建实例的数据文件目录
[root@CentOS /]# mkdir /data/oracle/inventory                  # 这是创建Oracle中央目录，Oracle 不建议将此目录创建到 ORACLE_BASE 中，不过不影响安装。
[root@CentOS /]# mkdir /data/oracle/fast_recovery_area  
[root@CentOS /]# chown -R oracle:oinstall /data/oracle   将目录所有者改为 Oracle 用户
[root@CentOS /]# chmod -R 775 /data/oracle </code></pre>
<p><strong>3.1.6 更改oracle用户的环境变量</strong><br>切换用户。</p>
<pre><code class="shell">[root@CentOS /]# su - oracle      # 中间加 - 可以将环境变量同时切换</code></pre>
<p>打开配置文件。</p>
<pre><code class="shell">[oracle@Centos /]$ vim ~/.bash_profile</code></pre>
<p>按照上一步创建的目录与文件内容，在该配置文件的后面追加以下内容：</p>
<pre><code># oracle 设置
ORACLE_BASE=/data/oracle            # oracle 的基目录
ORACLE_HOME=$ORACLE_BASE/product/11.2.0 # oracle 的安装目录
ORACLE_SID=orcl   # 这里必须和数据库实例名一致，所以创建的实例的时候要用这个名字
PATH=$PATH:$ORACLE_HOME/bin   # oracle的命令存放目录
ORACLE_UNQNAME=$ORACLE_SID
export ORACLE_BASE ORACLE_HOME ORACLE_SID PATH ORACLE_UNQNAME</code></pre>
<p>使用命令 <code>source ~/.bash_profile</code> 刷新一下。</p>
<p><strong>3.1.7 配置hostname</strong><br>使用命令 <code>hostname</code> 查看主机名，每个人不一样，比如我的是 <code>CentOS</code>。<br>使用命令 <code>vim /etc/hosts</code> 打开文件，追加一行主机与域名的记录。</p>
<pre><code># 要使用你的IP地址和你的主机名
192.168.1.1                   CentOS</code></pre>
<h4 id="3-2-安装数据库软件"><a href="#3-2-安装数据库软件" class="headerlink" title="3.2 安装数据库软件"></a>3.2 安装数据库软件</h4><p><strong>3.2.1 编辑静默安装响应文件</strong><br>静默安装数据库需要用到静默安装响应文件，静默安装响应文件就像使用图形化界面安装的时候点击的下一步、下一步一样，只不过是提前配置好，安装程序运行的时候就可以根据这个文件来做安装了。<br>切换到 <code>root</code> 用户，使用命令  <code>vim /opt/download/database/response/db_install.rsp</code> 打开静默安装响应文件。按照以下内容修改里面的内容：</p>
<pre><code class="shell"># 表示只安装数据库
oracle.install.option=INSTALL_DB_SWONLY
# 当前的主机名，可以使用命令 `hostname` 查看
ORACLE_HOSTNAME=CentOS
UNIX_GROUP_NAME=oinstall
# inventory 目录
INVENTORY_LOCATION=/data/oracle/inventory
SELECTED_LANGUAGES=en,zh_CN
ORACLE_HOME=/data/oracle/product/11.2.0
ORACLE_BASE=/data/oracle
## 安装的版本 - 企业版
oracle.install.db.InstallEdition=EE
oracle.install.db.DBA_GROUP=dba
oracle.install.db.OPER_GROUP=dba
DECLINE_SECURITY_UPDATES=true</code></pre>
<p>保存退出。</p>
<p><strong>3.2.2 使用oracle用户开始安装</strong></p>
<pre><code class="shell">[oracle@CentOS ~]$ cd /opt/download/database/response/
[oracle@CentOS response]$  ./runInstaller -silent -responseFile /opt/download/database/response/db_install.rsp -ignorePrereq</code></pre>
<p>这样，安装程序就在后台运行了，如果运行中发生了错误，提示信息中会有 [FATAL] 字样，出现这个字样说明安装失败，需要修改配置。<br>如果提示中出现 [WARNING] 字样可以不用理会，不会影响安装。<br>如果出现类似以下提示，就说明安装成功了，可能你的提示是英文版的。（不是自己的图，所以路径不对，请以你的路径为准）<br><img src="https://upload-images.jianshu.io/upload_images/15228836-12fa46d37f8f3f90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="安装成功提示信息.png"><br>然后按照提示，打开一个新的终端，使用 <code>root</code> 身份执行上面的两个脚本。<br>至此，数据库的安装就完成了。</p>
<h4 id="3-3-配置静默监听"><a href="#3-3-配置静默监听" class="headerlink" title="3.3 配置静默监听"></a>3.3 配置静默监听</h4><p>按照静默监听文件配置静默监听。<br>切换到 <code>oracle</code> 用户，运行命令：</p>
<pre><code class="shell"> [oracle@CentOS ~]$ netca /silent /responseFile /opt/download/database/response/netca.rsp</code></pre>
<p>执行成功后可以使用 <code>netstat</code> 命令查看是否正在监听。</p>
<pre><code class="shell">[oracle@CentOS ~]# netstat -tnulp | grep 1521</code></pre>
<p>出现类似下面的信息就是正在监听。<br><img src="https://upload-images.jianshu.io/upload_images/15228836-d8d1de1d6bd9650a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="正在监听"></p>
<h4 id="3-4-静默方式创建数据库同时建立实例"><a href="#3-4-静默方式创建数据库同时建立实例" class="headerlink" title="3.4 静默方式创建数据库同时建立实例"></a>3.4 静默方式创建数据库同时建立实例</h4><p><strong>3.4.1 编辑静默安装响应文件</strong><br>切换回 <code>root</code> 用户，编辑静默安装响应文件。</p>
<pre><code class="shell">[root@CentOS /]# vim /opt/download/database/response/dbca.rsp</code></pre>
<p>将文件内容做以下修改：</p>
<pre><code class="shell">GDBNAME= &quot;orcl&quot;
SID =&quot; orcl&quot;
SYSPASSWORD= &quot;oracle&quot;
SYSTEMPASSWORD= &quot;oracle&quot;
SYSMANPASSWORD= &quot;oracle&quot;
DBSNMPPASSWORD= &quot;oracle&quot;
DATAFILEDESTINATION=/data/oracle/oradata
RECOVERYAREADESTINATION=/data/oracle/fast_recovery_area
CHARACTERSET= &quot;ZHS16GBK&quot;
TOTALMEMORY= &quot;1638&quot;</code></pre>
<p><em>注：其中TOTALMEMORY =”1638” 为1638MB，物理内存2G x 80%。</em><br>保存退出。</p>
<p><strong>3.4.2 开始执行静默安装</strong><br>切换回 <code>oracle</code> 用户，执行命令：</p>
<pre><code>[oracle@CentOS ~]$ dbca -silent -responseFile /opt/download/database/response/dbca.rsp</code></pre>
<p>安装过程出现以下提示：（网上随便找的图，所以路径不一样）<br><img src="https://upload-images.jianshu.io/upload_images/15228836-7025a90eb0cd3d71.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="安装提示"><br>安装成功，检查一下实例。</p>
<pre><code>[oracle@CentOS ~]$ ps -ef | grep ora_ | grep -v grep</code></pre>
<p>出现进程信息（也是网图，路径一样）：<br><img src="https://upload-images.jianshu.io/upload_images/15228836-f97d3fd018bbc8a2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="进程信息"><br>查看以下监听状态：</p>
<pre><code>[oracle@CentOS ~]$ lsnrctl status</code></pre>
<p>出现提示：（网图）<br><img src="https://upload-images.jianshu.io/upload_images/15228836-d0e445b4e10c504e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="监听状态"><br><strong>3.4.3 登录查看实例状态</strong></p>
<pre><code>[oracle@CentOS~]$ sqlplus / as sysdba
......
......
SQL&gt; select status from v$instance;</code></pre>
<p>出现这种提示代表实例启动成功：（网图）<br><img src="https://upload-images.jianshu.io/upload_images/15228836-25843c54893d7aeb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="实例状态"><br>至此，数据库软件的安装和数据库实例的创建都成功了。</p>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
  <div class="footer" id="footer">
  <p>Copyright © 2020 <a class="flink" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>-<a class="flink"
      target="_blank" rel="noopener" href="https://github.com/sanjinhub/hexo-theme-geek">Geek</a>.
    <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
      <!-- <input type="checkbox" name="switch" id="update_style"> -->
      <span class="el-switch-style"></span>
    </label>
    <!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
  </p>
</div>
<input type="hidden" id="web_style" value="white">
<input type="hidden" id="valine_appid" value="Xzvozzq9Js3RB8cdgGFP7RP6-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="U47lrRiTDWUlYtJeL0NytIrc">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
  .v * {
    color: #698fca;
  }

  .v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
  }

  .v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
  }

  .v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
  }

  .v a {
    color: #8696b1;
  }

  .v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
  }
</style>
</body>

</html>